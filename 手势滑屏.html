<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		* {
			padding: 0;
			margin: 0;
		}
		div {
			width: 100%;
			height: 200px;
			background-color: yellow;
		}
		div:nth-child(2n) {
			background-color: green;
		}
	</style>
</head>
<body>
	<div>1</div>
	<div>2</div>
	<div>3</div>
	<div>4</div>
	<div>5</div>
	<div>6</div>
	<div>7</div>
	<div class="box">8</div>
	<div>9</div>
	<div>10</div>
	<div>11</div>
	<div>12</div>
	<div>13</div>
	<div>14</div>
	<div>15</div>
	<div>16</div>
	<div>17</div>
	<div>18</div>
	<div>19</div>
	<div>20</div>
</body>
<script>
(function(w, d) {
	function phoneSwiper(el) {
		this.elem = d.querySelector(el) || {};
		this.startx = 0;
		this.starty = 0;
	}
	phoneSwiper.prototype = {
		init: function(fn) {
			var _this = this;

			//手指接触屏幕
			_this.elem.addEventListener("touchstart", function(e){
			    _this.startx = e.touches[0].pageX;
			    _this.starty = e.touches[0].pageY;
			}, false);

			_this.elem.addEventListener("touchmove", function(e){
				var endy = e.changedTouches[0].pageY;
				if(Math.abs(_this.starty - endy) < 10){
			        e.preventDefault();
			    }
			}, { passive: false });

			//手指离开屏幕
			_this.elem.addEventListener("touchend", _this.debounce(function(e) {
			    var endx, endy;
			    endx = e.changedTouches[0].pageX;
			    endy = e.changedTouches[0].pageY;
			    var direction = _this.getDirection(_this.startx, _this.starty, endx, endy);
			    switch (direction) {
			        case 0:
			            break;
			        case 1:
                        fn && fn('top');
			            break;
			        case 2:
                        fn && fn('bottom');
			            break;
			        case 3:
                        fn && fn('last');
			            break;
			        case 4:
                        fn && fn('next');
			            break;
			        default:
			            break;
			    }
			}, 1500), false);
		},
		touch: function(fn) {
			this.init(fn)
		},
		getDirection: function(startx, starty, endx, endy) {
		    var angx = endx - startx;
		    var angy = endy - starty;
		    var result = 0;
		 
		    //如果滑动距离太短
		    if (Math.abs(angx) < 2 && Math.abs(angy) < 2) {
		        return result;
		    }
		 
		    var angle = this.getAngle(angx, angy);
		    // console.log(angle)
		    if (angle >= -165 && angle <= -15) {
		        result = 1; //向上
		    } else if (angle > 15 && angle < 165) {
		        result = 2; //向下
		    } else if ((angle >= 165 && angle <= 180) || (angle >= -180 && angle < -165)) {
		        result = 3; //向左
		    } else if (angle >= -15 && angle <= 15) {
		        result = 4; //向右
		    }
		    return result;
		},
		getAngle: function(angx, angy) {
		    return Math.atan2(angy, angx) * 180 / Math.PI;
		},
		debounce: function(callback, delay){
		    var timer = null //借助闭包
		    return function(event) {
		    	var _this = this
		        if (timer) clearTimeout(timer)
		        timer = setTimeout(function() {
		        	return callback.call(_this, event)
		        }, delay) // 简化写法
		    }
		}
	}
	w.phoneSwiper = function(el) {
		return new phoneSwiper(el)
	}
}(this, document));


phoneSwiper('body').touch((dirc) => {
	console.log(dirc)
})
/*var startx, starty;
 
//获得角度
function getAngle(angx, angy) {
    return Math.atan2(angy, angx) * 180 / Math.PI;
};
 
//根据起点终点返回方向 1向上滑动 2向下滑动 3向左滑动 4向右滑动 0点击事件
function getDirection(startx, starty, endx, endy) {
	console.log(starty, endy)
    var angx = endx - startx;
    var angy = endy - starty;
    var result = 0;
 
    //如果滑动距离太短
    if (Math.abs(angx) < 2 && Math.abs(angy) < 2) {
        return result;
    }
 
    var angle = getAngle(angx, angy);
    // console.log(angle)
    if (angle >= -165 && angle <= -15) {
        result = 1; //向上
    } else if (angle > 15 && angle < 165) {
        result = 2; //向下
    } else if ((angle >= 165 && angle <= 180) || (angle >= -180 && angle < -165)) {
        result = 3; //向左
    } else if (angle >= -15 && angle <= 15) {
        result = 4; //向右
    }
    return result;
}
 
//手指接触屏幕
document.addEventListener("touchstart", function(e){
    startx = e.touches[0].pageX;
    starty = e.touches[0].pageY;
}, false);
 
//手指离开屏幕
document.addEventListener("touchend", function(e) {
    var endx, endy;
    endx = e.changedTouches[0].pageX;
    endy = e.changedTouches[0].pageY;
    var direction = getDirection(startx, starty, endx, endy);
    switch (direction) {
        case 0:
            console.log("点击！")
            break;
        case 1:
            console.log("向上！")
            break;
        case 2:
            console.log("向下！")
            break;
        case 3:
            console.log("向左！")
            break;
        case 4:
            console.log("向右！")
            break;
        default:
            console.log("点击！")
            break;
    }
}, false);*/
</script>
</html>